---
title: "Perspectives on computational analysis - PS3"
author: "Maria Adelaida Martinez Cabrera"
date: "10/24/2018"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load necessary libraries and set seed.
library(tidyverse)
library(dplyr)
library(data.table)
set.seed(1234)

```

# Question 1: Simulation in Sociology, Moretti (2002)

In this paper, the author analyzes how simulative models can be applied in sociology. One of the important ideas highlighted by the article is the validity of the simulative model as representations of the real world. In general, the validity of all simulative models is determined by the validity of the theory in which the model is based. They can assess the consequences of changes in different variables, but can't determine whether the conditions in which the model is based are a good representation of the reality. This could be seen as a weakness of the multi-agent systems because they are entirely based on the way the individual is model. Modeling the individual requires a fully determined system of rules of behavior, protocols of communication and decision-making that take into account the interactions with other agents. Then the accuracy of the individual model is going to be the basis of the validity for a multi-agent system. 

Cellular automata are a particular type of multi-agent systems in which the agents are homogeneous in their behavior and interaction with other agents, and they have a fixed position inside the system. The author describes two specific weaknesses regarding the validity of this systems. First, the cellular automata assume that all the agents update at the same time their states. This assumption is not plausible in a social process because the agents tend to change their attitudes and opinions at different moments. For example, changes in social interactions generated by technology can change agents attitudes at a different path. The introduction of tools like Facebook, Instagram, snap chat, haven't changed in the same way and at the same time the social interactions for all generations. Most of the oldest generations are not even using this tools, and their social interactions steel unchanged.

Secondly, the cellar automata are restricted by its spatial structures. These structures establish the subset of the population each agent interacts with. Restricting the individual with whom an individual has potential interaction could be seen as valid, the problem is in the difficulty of defining valid groups of interaction for each agent. In the real world people interact with people that are not physically close, again the media and social networks will make this definition even harder. Another possibility is also that the interaction groups have some dynamic components that make them change over time.

On the other hand, the capacity of modeling dynamic feedback makes the simulative models more valid regarding being good at modeling certain types of social interactions. One example of a Sociological model that exhibits dynamic feedback cite by the author is the cultural evolution model. In this example, all the cultural changes are given by innovation, that causes behavioral changes in the agents and therefore changes in the organization of the society as a whole. This reorganization is then the start point of more innovation. Another example of a research question where the underlying system exhibits dynamic feedback is the study of the institutions, its evolution, and formation. How the internal conflicts shaped political institutions, and how these institutions encourage the extension of the conflict. Is a question where clearly we can see the dynamic feedback between the institutions and the incentives of being in war.

In conclusion, simulative methods have both weaknesses and strength as valid representations of the real world. As the author stated it, the most critical challenge of simulative models will be the search for more flexible tools able to define the connection between the computational models and the complex social interactions in the empirical world

# Question 2
** Assume that all of you will graduate from MACSS program at the University of Chicago in June 2020. Your annual income from the time you graduate to the end of your life is generated by the following process,**

$ln(inc_2020) = ln(inc_0) + ln(\varepsilon_2020)$ and 

$ln(inc_t) = (1-\rho)[ln(inc_0) + g(t-2020)]+\rho ln(inc_{t-1})+ln(\varepsilon_t)$ for $2021 \leq t \leq 2059$

**where the variable $inc_t$ is your annual income in year $t \geq 2020$, $inc_0$ is the average starting income $(t = 2018)$ for a MACSS student, $\rho \in [0,1)$ reflects some positive dependence of today's income on last period's income, $g$ is a long-run annual growth rate for your annual salary, and $\varepsilon_t$ is an error term that is distributed lognormal $LN(0,\sigma)$ where $\sigma$ is the standard deviation of the log of the error term. That is, $ln(\varepsilon_t)$ is distributed normal $N(0,\sigma)$.**

\textbf{(a)}Let the standard deviation of your income process be $\sigma = 0.13$,
let the persistence be $\rho = 0.4$, let the long-run growth rate of income be $g = 0.025$, and let average initial income be $inc_0 =\$80,000$. Assume you will work for 40 years after you graduate (2020 to 2059). Simulate 10,000 different realizations of your lifetime income. Do this by first drawing 10,000 sets of 40 normally distributed errors with mean 0 and standard deviation $\sigma = 0.13$. Then plug those into the income process (1) to simulate your lifetime income. Plot one of the lifetime income paths. Make sure your axes are correctly labeled and your plot has a title.

```{r echo=FALSE}

# Create a function to calculate increasing annual income.
income <- function(base_inc, rho, g, sigma, n_years, start_year = 2020){
  
  epsilon <- rnorm(n_years, mean = 0, sd = sigma)
  
  income_log <- vector("numeric", n_years)
  
# Define the process
  for(year in seq_len(n_years)){
    if(year == 1){
      income_log[[year]] <- log(base_inc) + epsilon[[year]]
    } else {
      income_log[[year]] <- (1-rho)*(log(base_inc)+g*(year)) + rho*income_log[[year-1]] + epsilon[[year]]
    }
  }
  
# Output of a data frame, with variables of income and year.
  data_frame(inc = exp(income_log),
             year = 2020 + seq_len(n_years) - 1)
}

# Simulate the data iterations, then create a data frame 
  n_sims <- 10000
  n_years <- 40

  simulated_income <- n_sims %>%
 
  rerun(income(base_inc = 80000, rho = 0.4, g = 0.025, sigma = 0.13,            n_years = n_years, start_year = 2020)) %>%
    
  bind_rows(.id = "id") %>%

  select(id, year, inc)

# Plot
  simulated_income %>%
  filter(id == 1) %>%
  ggplot(aes(year, inc)) +
  geom_line() +
  labs(title = "Simulated lifetime income path",
       x = "Year", 
       y = "Annual Income") +
  scale_y_continuous(labels = scales::dollar)


```
\textbf{(b)} Plot a histogram with 50 bins of year $t = 2020$ initial income for each of the 10,000 simulations. What percent of your class will earn more than $\$100,000$ in the first year out of the program? What percent of the class will earn less than $\$70,000$? Is the distribution normally distributed
(i.e., symmetric and bell curved)?

4.32% of the class will earn more than $\$100,000$ in the first year out of the program, and 15.54% will earn less than $\$70,000$. As we can see in the histogram the distribution of the income is normally distributed, symmetric and bell curved. This is not surprising given that by construction according to our simulation model, all the variance of the first year comes from a normally distributed error.

```{r echo=FALSE}

hist(simulated_income$inc[simulated_income$year==2020], breaks=50, xlab="Income in US dollars",col="coral1", main = "Histogram income in the first year out of the program")

simulated_income$more_100k <-ifelse(simulated_income$inc>100000,1,0)
simulated_income$less_70k  <-ifelse(simulated_income$inc<70000,1,0)

first_year <- subset(simulated_income, simulated_income$year==2020)

perc_m100k <- mean (first_year$more_100k)
perc_l70k <- mean (first_year$less_70k)
cbind(perc_m100k, perc_l70k)

```

\textbf{(c)}Suppose you graduate from the MACSS program with $\$95,000$ of zero-interest debt. You will use 10% of your annual salary after you graduate to pay of this loan. Plot the histogram of how many years it takes to pay of the loan in each of your $10,000$ simulations. This histogram will only have as many bins as you have unique years in which people pay of their debt. In what percent of the simulations are you able to pay of the loan in 10 years (on or before $t = 2029$)?

25.92% of the simulations are able to pay the loan in 10 years or before and 74.08% after 10 years.

```{r echo=FALSE}

#We create the variable 10% of incomes
simulated_income$Income_10 <- simulated_income$inc*.1
simulated_income$payment1<- ave(simulated_income$Income_10, simulated_income$id, FUN=cumsum)
#We create the cumulative sum of payment
payment2<- filter(simulated_income, simulated_income$payment1>=95000)
minyear<- ave(simulated_income$year, simulated_income$id, FUN = min)

#We keep the min year
payment_year<-setDT(payment2)[, .SD[which.min(year)], by = id]
par(mfrow=c(1, 2))
histogram_payment <-hist(payment_year$year, main="Year in which Debt is pay", xlab="year",col="coral1")

#Below and above 2029
payment_prior_2029<- (sum(histogram_payment$counts[histogram_payment$breaks<=2029])/10000)
payment_post_2029<- ((10000-sum(histogram_payment$counts[histogram_payment$breaks<=2029]))/10000)
cbind(payment_prior_2029, payment_post_2029)


```

\textbf{(d)}Now suppose that the Chicago MACSS program becomes very well known in the next two years, and the skills you are learning are demanded more by employers. This increases the average starting salary to $inc_0 =\$90,000$, but the standard deviation in incomes increases also to $\sigma = 0.17$. Plot the new histogram of how many years it takes to pay your loan of $\$95,000$ in your new $10,000$ simulations with the new standard deviation and the new average initial salary. In what percent of the simulations are you able to pay of the loan in 10 years (on or before $t = 2029$)?

82.68% of the simulations are able to pay the loan in 10 years or before and 17.32% after 10 years.


```{r echo=FALSE}

# Simulate the data iterations, then create a data frame with new parameters 
  n_sims <- 10000
  n_years <- 40

  simulated_income2 <- n_sims %>%
 
  rerun(income(base_inc = 90000, rho = 0.4, g = 0.025, sigma = 0.17,            n_years = n_years, start_year = 2020)) %>%
    
  bind_rows(.id = "id") %>%

  select(id, year, inc)
  
#We create the variable 10% of incomes
simulated_income2$Income_10 <- simulated_income2$inc*.1
simulated_income2$payment1<- ave(simulated_income2$Income_10, simulated_income2$id, FUN=cumsum)
#We create the cumulative sum of payment
payment22<- filter(simulated_income2, simulated_income2$payment1>=95000)
minyear2<- ave(simulated_income2$year, simulated_income2$id, FUN = min)

#We keep the min year
payment_year2<-setDT(payment22)[, .SD[which.min(year)], by = id]
par(mfrow=c(1, 2))
histogram_payment2 <-hist(payment_year2$year, main="Year in which Debt is pay", xlab="year",col="coral1")

#Below and above 2029
payment_prior_2029_2<- (sum(histogram_payment2$counts[histogram_payment2$breaks<=2029])/10000)
payment_post_2029_2<- ((10000-sum(histogram_payment2$counts[histogram_payment2$breaks<=2029]))/10000)
cbind(payment_prior_2029_2, payment_post_2029_2)



```